{% load static %}
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Dashboard - Workout</title>

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>

		<script src="https://cdn.tailwindcss.com"></script>
		<link rel="stylesheet" href="{% static 'css/main.css' %}" />
	</head>

	<body
		class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 text-slate-900"
	>
		<!-- NAVBAR -->
		<nav class="sticky top-0 z-50 bg-white/90 backdrop-blur shadow">
			<div
				class="mx-auto flex max-w-6xl items-center justify-between px-5 py-4"
			>
				<div class="text-2xl font-extrabold text-indigo-700">
					üí™ SmartHealth
				</div>

				<div
					class="flex items-center gap-4 text-sm font-semibold text-slate-700"
				>
					<a
						href="{% url 'dashboard' %}"
						class="px-3 py-2 hover:text-indigo-600"
						>Home</a
					>
					<a
						href="{% url 'dashboard_diet' %}"
						class="px-3 py-2 hover:text-indigo-600"
						>Diet</a
					>
					<a
						href="{% url 'dashboard_workout' %}"
						class="px-3 py-2 text-indigo-700 border-b-2 border-indigo-600"
						>Workout</a
					>
				</div>

				<div class="flex items-center gap-3 text-sm font-medium">
					<span class="hidden sm:inline"
						>Hi, {{ user.username }}</span
					>
					<a
						href="{% url 'logout' %}"
						class="rounded-lg bg-gradient-to-r from-red-500 to-red-600 px-4 py-2 text-white font-semibold shadow hover:shadow-lg transition"
					>
						Logout
					</a>
				</div>
			</div>
		</nav>

		<main class="max-w-5xl mx-auto py-12 px-4">
			{% if messages %}
			<div class="space-y-3 mb-8">
				{% for message in messages %}
				<div
					class="flex items-start gap-3 rounded-2xl border px-5 py-4 shadow-sm {% if 'success' in message.tags %}border-green-200 bg-green-50 text-green-800{% elif 'error' in message.tags or 'danger' in message.tags %}border-red-200 bg-red-50 text-red-800{% elif 'warning' in message.tags %}border-amber-200 bg-amber-50 text-amber-800{% else %}border-indigo-200 bg-indigo-50 text-indigo-800{% endif %}"
				>
					<div
						class="flex h-8 w-8 items-center justify-center rounded-full {% if 'success' in message.tags %}bg-green-100{% elif 'error' in message.tags or 'danger' in message.tags %}bg-red-100{% elif 'warning' in message.tags %}bg-amber-100{% else %}bg-indigo-100{% endif %}"
					>
						{% if 'success' in message.tags %}
						<span class="text-lg">‚úÖ</span>
						{% elif 'error' in message.tags or 'danger' in message.tags %}
						<span class="text-lg">‚õî</span>
						{% elif 'warning' in message.tags %}
						<span class="text-lg">‚ö†Ô∏è</span>
						{% else %}
						<span class="text-lg">‚ÑπÔ∏è</span>
						{% endif %}
					</div>
					<div class="text-sm leading-relaxed">{{ message }}</div>
				</div>
				{% endfor %}
			</div>
			{% endif %}

			{% if plan and plan.workout_plan %}

			<section>
				<!-- HEADER -->
				<div class="flex items-center gap-4 mb-8">
					<span class="text-5xl">‚ö°</span>
					<div>
						<h1 class="text-4xl font-extrabold">
							Weekly Workout Plan
						</h1>
						<p class="text-slate-600 mt-1">
							Follow your routine consistently for best results
						</p>
					</div>
				</div>

				

				<!-- WORKOUT DAY CONTAINER -->
				<div id="workoutContainer">
					{% for workout_day in plan.workout_plan %}
					<div
						class="workout-day {% if forloop.first %}active{% endif %} hidden"
						data-day="{{ forloop.counter0 }}"
					>
						<div
							class="bg-white rounded-2xl shadow-xl overflow-hidden"
						>
							<!-- DAY HEADER -->
							<div
								class="bg-gradient-to-r from-orange-400 to-red-500 p-5"
							>
								<div
									class="flex flex-col md:flex-row md:justify-between md:items-center gap-4"
								>
									<div>
										<h3
											class="text-4xl font-bold text-white mb-2"
										>
											{{ workout_day.day }}
										</h3>
										<p
											class="text-orange-100 text-lg font-medium"
										>
											{{ workout_day.focus }}
										</p>
									</div>

									<div class="flex gap-4">
										<div
											class="bg-white/20 backdrop-blur rounded-xl px-6 py-3 text-center"
										>
											<p
												class="text-xs text-white/80 uppercase tracking-wide"
											>
												Duration
											</p>
											<p
												class="text-2xl font-bold text-white"
											>
												{{ profile.workout_duration_minutes}}<span class="text-sm">
													min</span
												>
											</p>
										</div>
										<div
											class="bg-white/20 backdrop-blur rounded-xl px-6 py-3 text-center"
										>
											<p
												class="text-xs text-white/80 uppercase tracking-wide"
											>
												Calories
											</p>
											<p
												class="text-2xl font-bold text-white"
											>
												{{ workout_day.calories }}
											</p>
										</div>
									</div>
								</div>
							</div>

							<!-- EXERCISES -->
						<div class="p-5">
								{% if workout_day.exercises %}
								<h4
									class="text-2xl font-bold mb-4 flex items-center gap-2"
								>
									<span class="text-orange-500">üèãÔ∏è</span>
									Today's Exercises
								</h4>

								<div class="space-y-3">
									{% for exercise in workout_day.exercises %}
									<div
										class="flex gap-4 p-3 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl hover:shadow-md transition border border-slate-200"
									>
										<div
											class="w-10 h-10 flex items-center justify-center bg-gradient-to-br from-orange-400 to-red-500 text-white rounded-full font-bold text-lg shadow"
										>
											{{ forloop.counter }}
										</div>

										<div class="flex-1">
											<h5 class="font-bold text-lg mb-2 text-slate-900">
												{{ exercise.name }}
											</h5>
											<div class="flex flex-wrap gap-2 text-sm">
												{% if exercise.sets %}
												<span class="px-4 py-1.5 bg-blue-100 text-blue-700 rounded-full font-semibold">{{ exercise.sets }} sets</span>
												{% endif %}
												{% if exercise.reps %}
												<span class="px-4 py-1.5 bg-green-100 text-green-700 rounded-full font-semibold">{{ exercise.reps }} reps</span>
												{% endif %}
												{% if exercise.duration_sec %}
												<span class="px-4 py-1.5 bg-purple-100 text-purple-700 rounded-full font-semibold">{{ exercise.duration_sec }}s</span>
												{% endif %}
												{% if exercise.rest_sec %}
												<span class="px-4 py-1.5 bg-amber-100 text-amber-700 rounded-full font-semibold">{{ exercise.rest_sec }}s rest</span>
												{% endif %}
											</div>
										</div>
									</div>
									{% endfor %}
								</div>

								{% else %}
								<div class="text-center py-20">
									<div class="text-6xl mb-4">üõå</div>
									<h4
										class="text-2xl font-bold text-slate-700 mb-2"
									>
										Rest & Recovery Day
									</h4>
									<p class="text-slate-500">
										Let your body recharge and repair
									</p>
								</div>
								{% endif %}
							</div>
						</div>
					</div>
					{% endfor %}
				</div>
<!-- Day Navigator -->
				<div class="flex items-center justify-center gap-4 mb-8 mt-4">
					<button
						id="prevDay"
						class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
					>
						<svg
							class="w-5 h-5"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M15 19l-7-7 7-7"
							/>
						</svg>
						Previous
					</button>

					<div class="flex gap-2">
						{% for workout_day in plan.workout_plan %}
						<button
							class="day-dot w-3 h-3 rounded-full bg-slate-300 hover:bg-indigo-400 transition"
							data-day="{{ forloop.counter0 }}"
						></button>
						{% endfor %}
					</div>

					<button
						id="nextDay"
						class="px-4 py-2 bg-indigo-500 text-white rounded-lg font-semibold hover:bg-indigo-600 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
					>
						Next
						<svg
							class="w-5 h-5"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M9 5l7 7-7 7"
							/>
						</svg>
					</button>
				</div>
				<!-- Progress Indicator -->
				<div class="mt-8 text-center">
					<p class="text-slate-600 font-medium">
						Day <span id="currentDayNumber">1</span> of 
					7 
					</p>
				</div>
				<!-- TIPS (Collapsible) -->
				{% if plan.safety_tips %}
				<div
					class="bg-blue-50 border-l-4 border-blue-500 rounded-xl p-6 mb-8"
				>
					<button
						id="toggleTips"
						class="w-full text-left flex items-center justify-between"
					>
						<h2 class="text-xl font-bold flex items-center gap-2">
							üí° Fitness Tips
						</h2>
						<svg
							id="tipsIcon"
							class="w-5 h-5 transform transition-transform"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M19 9l-7 7-7-7"
							/>
						</svg>
					</button>
					<ul id="tipsList" class="space-y-2 mt-4 hidden">
						{% for tip in plan.safety_tips %}
						<li class="flex gap-2 text-slate-700">
							<span class="text-blue-500 font-bold">‚úì</span>
							<span>{{ tip }}</span>
						</li>
						{% endfor %}
					</ul>
				</div>
				{% endif %}
			</section>

			<script>
				let currentDay = 0;
				const totalDays = {{ plan.workout_plan|length }};
				const workoutDays = document.querySelectorAll('.workout-day');
				const prevBtn = document.getElementById('prevDay');
				const nextBtn = document.getElementById('nextDay');
				const dayDots = document.querySelectorAll('.day-dot');
				const currentDayNumber = document.getElementById('currentDayNumber');

				function showDay(index) {
					workoutDays.forEach((day, i) => {
						if (i === index) {
							day.classList.remove('hidden');
							day.classList.add('active');
						} else {
							day.classList.add('hidden');
							day.classList.remove('active');
						}
					});

					dayDots.forEach((dot, i) => {
						if (i === index) {
							dot.classList.remove('bg-slate-300');
							dot.classList.add('bg-indigo-600', 'scale-125');
						} else {
							dot.classList.add('bg-slate-300');
							dot.classList.remove('bg-indigo-600', 'scale-125');
						}
					});

					prevBtn.disabled = index === 0;
					nextBtn.disabled = index === totalDays - 1;
					currentDayNumber.textContent = index + 1;

					window.scrollTo({ top: 0, behavior: 'smooth' });
				}

				prevBtn.addEventListener('click', () => {
					if (currentDay > 0) {
						currentDay--;
						showDay(currentDay);
					}
				});

				nextBtn.addEventListener('click', () => {
					if (currentDay < totalDays - 1) {
						currentDay++;
						showDay(currentDay);
					}
				});

				dayDots.forEach((dot, index) => {
					dot.addEventListener('click', () => {
						currentDay = index;
						showDay(currentDay);
					});
				});

				// Tips toggle
				const toggleTips = document.getElementById('toggleTips');
				const tipsList = document.getElementById('tipsList');
				const tipsIcon = document.getElementById('tipsIcon');

				if (toggleTips) {
					toggleTips.addEventListener('click', () => {
						tipsList.classList.toggle('hidden');
						tipsIcon.classList.toggle('rotate-180');
					});
				}

				// Keyboard navigation
				document.addEventListener('keydown', (e) => {
					if (e.key === 'ArrowLeft' && currentDay > 0) {
						currentDay--;
						showDay(currentDay);
					} else if (e.key === 'ArrowRight' && currentDay < totalDays - 1) {
						currentDay++;
						showDay(currentDay);
					}
				});

				// Initialize
				showDay(currentDay);
			</script>

			{% else %}

			<!-- NO PLAN -->
			<section class="bg-white rounded-3xl shadow p-16 text-center">
				<div class="text-7xl mb-6">‚ö°</div>
				<h2 class="text-4xl font-bold mb-4">No Workout Plan Yet</h2>
				<p class="text-slate-600 mb-8">
					Generate your personalized workout routine to get started.
				</p>
				<form method="POST">
					{% csrf_token %}
					<button
						class="px-10 py-4 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition"
					>
						Generate My Plan
					</button>
				</form>
			</section>

			{% endif %}
		</main>
	</body>
</html>
